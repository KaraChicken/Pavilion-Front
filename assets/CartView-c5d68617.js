import{E as b,D as T,r as x,e as g,o as D,G as N,H as v,K as $,L as n,S as A,c as r,J as C,R as u,Q as h,a1 as E}from"./index-562a446d.js";import{S as l}from"./sweetalert2.all-04b561c2.js";import{V as L}from"./VContainer-514eef56.js";import{V as y}from"./VCol-728d925e.js";import{b as P}from"./VList-5c2ee626.js";import{V as R}from"./VDataTable-d96c1792.js";import{V as d}from"./VBtn-894b3729.js";/* empty css              */import"./tag-91a9a1d5.js";import"./index-9b97b54a.js";import"./index-c8533bed.js";import"./VAvatar-1f9d386c.js";import"./VSelect-a3a436ff.js";import"./VTextField-a9ab6984.js";import"./VOverlay-efb7e329.js";import"./scopeId-495a2c4b.js";const G=E("h1",null,"購物車",-1),H={key:0},I={key:1,class:"text-red text-decoration-line-through"},rt={__name:"CartView",setup(J){const{apiAuth:p}=A(),m=b(),k=T(),s=x([]),V=[{title:"商品名稱",key:"product.name"},{title:"單價",key:"product.price"},{title:"數量",key:"quantity"},{title:"總價",key:"total",value:e=>e.product.price*e.quantity},{title:"操作",key:"action"}],B=g(()=>s.value.reduce((e,a)=>e+a.quantity*a.product.price,0)),q=g(()=>s.value.length>0&&!s.value.some(e=>!e.product.sell)),f=async(e,a)=>{var o,t;if(!m.isLogin){k.push("/login");return}try{const{data:c}=await p.patch("/users/cart",{product:e,quantity:a});m.cart=c.result,l.fire({icon:"success",title:"修改成功",timer:2500});const i=s.value.findIndex(S=>S.product._id===e);s.value[i].quantity+=a,s.value[i].quantity<=0&&s.value.splice(i,1)}catch(c){const i=((t=(o=c==null?void 0:c.response)==null?void 0:o.data)==null?void 0:t.message)||"發生錯誤，請稍後再試";l.fire({icon:"error",title:i,confirmButtonText:"確定"})}},_=x(!1),w=async()=>{var e,a;_.value=!0;try{await p.post("/orders"),m.cart=0,k.push("/orders"),l.fire({icon:"success",title:"結帳成功",timer:2500})}catch(o){const t=((a=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";l.fire({icon:"error",title:t,confirmButtonText:"確定"})}_.value=!1};return D(async()=>{var e,a;try{const{data:o}=await p.get("/users/cart");s.value.push(...o.result)}catch(o){const t=((a=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:a.message)||"發生錯誤，請稍後再試";l.fire({icon:"error",title:t,confirmButtonText:"確定"})}}),(e,a)=>{const o=N("P");return v(),$(L,null,{default:n(()=>[r(y,{cols:"12"},{default:n(()=>[G]),_:1}),r(P),r(y,{cols:"12"},{default:n(()=>[r(R,{items:s.value,headers:V},{"item.product.name":n(({item:t})=>[t.product.sell?(v(),C("span",H,u(t.product.name),1)):(v(),C("span",I,u(t.product.name)+" (已下架)",1))]),"item.quantity":n(({item:t})=>[r(d,{variant:"text",icon:"mdi-minus",color:"red",onClick:c=>f(t.product._id,-1)},null,8,["onClick"]),h(u(t.quantity),1),r(d,{variant:"text",icon:"mdi-plus",color:"green",onClick:c=>f(t.product._id,1)},null,8,["onClick"])]),"item.action":n(({item:t})=>[r(d,{variant:"text",icon:"mdi-delete",color:"red",onClick:c=>f(t.product._id,t.quantity*-1)},null,8,["onClick"])]),_:2},1032,["items"])]),_:1}),r(y,{class:"text-center",cols:"12"},{default:n(()=>[r(o,null,{default:n(()=>[h("總金額: "+u(B.value),1)]),_:1}),r(d,{color:"green",disabled:!q.value,loading:_.value,onClick:w},{default:n(()=>[h("結帳")]),_:1},8,["disabled","loading"])]),_:1})]),_:1})}}};export{rt as default};
