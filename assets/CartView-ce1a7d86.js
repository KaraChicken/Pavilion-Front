import{_ as S,E as T,D as A,r as C,e as V,o as E,G as d,H as x,K as H,L as r,S as R,c as s,Q as p,J as w,R as m}from"./index-d3dd28c5.js";import{S as u}from"./sweetalert2.all-04b561c2.js";import{V as $}from"./VCol-712d19e7.js";import{V as I}from"./VDataTable-0cb1db4b.js";import{V as _}from"./VBtn-1e4ea61f.js";import{V as L}from"./VRow-51c11ea3.js";/* empty css              */import"./tag-9973796e.js";import"./index-18fe2d18.js";import"./VSelect-1f26c921.js";import"./VTextField-1b0f2b7b.js";import"./index-40810cd0.js";import"./VList-fcdaf33d.js";import"./VAvatar-136d735d.js";import"./VOverlay-9642f210.js";import"./scopeId-96dadfe6.js";const N={key:0},P={key:1,class:"text-red text-decoration-line-through"},j={__name:"CartView",setup(F){const{apiAuth:f}=R(),v=T(),k=A(),n=C([]),b=[{title:"商品名稱",key:"product.name"},{title:"單價",key:"product.price"},{title:"數量",key:"quantity"},{title:"總價",key:"total",value:t=>t.product.price*t.quantity},{title:"操作",key:"action"}],q=V(()=>n.value.reduce((t,o)=>t+o.quantity*o.product.price,0)),B=V(()=>n.value.length>0&&!n.value.some(t=>!t.product.sell)),y=async(t,o)=>{var e,c;if(!v.isLogin){k.push("/login");return}try{const{data:i}=await f.patch("/users/cart",{product:t,quantity:o});v.cart=i.result,u.fire({icon:"success",title:"修改成功",timer:2500});const l=n.value.findIndex(a=>a.product._id===t);n.value[l].quantity+=o,n.value[l].quantity<=0&&n.value.splice(l,1)}catch(i){const l=((c=(e=i==null?void 0:i.response)==null?void 0:e.data)==null?void 0:c.message)||"發生錯誤，請稍後再試";u.fire({icon:"error",title:l,confirmButtonText:"確定"})}},h=C(!1),D=async()=>{var t,o;h.value=!0;try{await f.post("/orders"),v.cart=0,k.push("/orders"),u.fire({icon:"success",title:"結帳成功",timer:2500})}catch(e){const c=((o=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:o.message)||"發生錯誤，請稍後再試";u.fire({icon:"error",title:c,confirmButtonText:"確定"})}h.value=!1};return E(async()=>{var t,o;try{const{data:e}=await f.get("/users/cart");n.value.push(...e.result)}catch(e){const c=((o=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:o.message)||"發生錯誤，請稍後再試";u.fire({icon:"error",title:c,confirmButtonText:"確定"})}}),(t,o)=>{const e=d("H1"),c=d("P"),i=d("Div"),l=d("VCantainer");return x(),H(l,null,{default:r(()=>[s(L,{style:{height:"100%"}},{default:r(()=>[s($,{class:"d-flex justify-center align-center",cols:"12"},{default:r(()=>[s(i,{class:"pa-5 overflow",style:{width:"75rem",height:"43.75rem","border-radius":"20px","background-color":"#CAAD5F"}},{default:r(()=>[s(e,{class:"text-center mb-10",style:{color:"#261E47"}},{default:r(()=>[p("購物車")]),_:1}),s(I,{items:n.value,headers:b},{"item.product.name":r(({item:a})=>[a.product.sell?(x(),w("span",N,m(a.product.name),1)):(x(),w("span",P,m(a.product.name)+" (已下架)",1))]),"item.quantity":r(({item:a})=>[s(_,{variant:"text",icon:"mdi-minus",color:"red",onClick:g=>y(a.product._id,-1)},null,8,["onClick"]),p(m(a.quantity),1),s(_,{variant:"text",icon:"mdi-plus",color:"green",onClick:g=>y(a.product._id,1)},null,8,["onClick"])]),"item.action":r(({item:a})=>[s(_,{variant:"text",icon:"mdi-delete",color:"red",onClick:g=>y(a.product._id,a.quantity*-1)},null,8,["onClick"])]),_:2},1032,["items"]),s(i,{class:"text-center mt-15"},{default:r(()=>[s(c,null,{default:r(()=>[p("總金額: "+m(q.value),1)]),_:1}),s(_,{color:"primary",disabled:!B.value,loading:h.value,onClick:D},{default:r(()=>[p("結帳")]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},rt=S(j,[["__scopeId","data-v-dde68c90"]]);export{rt as default};
