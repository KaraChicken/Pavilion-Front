import{r as n,H as M,J as E,c as a,L as o,N as J,S as Q,Q as m,ac as Z,R as N,K as j,M as z,P as r,Z as G,a0 as W}from"./index-8f327957.js";import{c as X,a as P,f as Y,u as ee,b as y,V as te}from"./VForm-8ae878e1.js";import{S as U}from"./sweetalert2.all-04b561c2.js";import{V as ae}from"./VContainer-1ee2bd48.js";import{V as le,a as oe,b as re,c as se,d as ne}from"./VTextarea-333f6502.js";import{V as ue}from"./VRow-106a1998.js";import{V as _}from"./VCol-c80f8076.js";import{b as ie}from"./VList-1b2cffbf.js";import{V as k}from"./VBtn-837c59bf.js";import{V as I}from"./VTextField-e65f6a72.js";import{d as de,V as me,b as pe,c as ce}from"./VCard-9aa14b3c.js";import{V as ge}from"./VSelect-3d6f16e8.js";import{i as ve}from"./index-6c4cdc40.js";/* empty css              */import"./tag-0f71946a.js";import"./VAvatar-095a8fd0.js";import"./VDataTable-1fc3cf6c.js";import"./VOverlay-d5accc61.js";import"./scopeId-afa33d66.js";import"./index-bb123c91.js";const fe=W("h1",{class:"text-center"},"消息發布",-1),qe={__name:"NewsView",setup(Ve){const{apiAuth:w}=Q();n(null);const p=n(!1),i=n(""),A=l=>{l?(i.value=l._id,c.value.value=l.title,v.value.value=l.group,g.value.value=l.content,f.value.value=l.poText):i.value="",p.value=!0},D=()=>{p.value=!1,K()},$=["公休","活動","其他"],q=X({title:P().required("請輸入標題").min(2,"標題太短").max(50,"標題太長"),group:P().required("請選擇類別").oneOf(["公休","活動","其他"],"類別選擇錯誤"),content:P().required("請輸入內容").min(10,"內容太短").max(100,"內容太長"),poText:Y().required("請選擇貼文上架狀態")}),{handleSubmit:L,isSubmitting:T,resetForm:K}=ee({validationSchema:q,initialValues:{group:"",title:"",content:"",poText:!1,_id:""}}),c=y("title"),g=y("content"),v=y("group"),f=y("poText"),H=L(async l=>{var t,e;try{i.value===""?await w.post("/news",{group:l.group,title:l.title,content:l.content,poText:l.poText}):await w.patch("/news/"+i.value,{group:l.group,title:l.title,content:l.content,poText:l.poText});const s=i.value===""?"新增成功":"編輯成功";U.fire({position:"center",icon:"success",title:s,showConfirmButton:!1,timer:1500}),D(),h()}catch(s){console.log(s);const u=((e=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";U.fire({position:"center",icon:"error",title:u,showConfirmButton:!1})}}),C=n(10),V=n([{key:"createdAt",order:"desc"}]),b=n(1),S=n([]),O=[{title:"類別",align:"center",sortable:!0,key:"group"},{title:"標題",align:"center",sortable:!1,key:"title"},{title:"內容",align:"center",sortable:!0,key:"content"},{title:"上架狀態",align:"center",sortable:!0,key:"poText"},{title:"編輯",align:"center",sortable:!1,key:"edit"}],B=n(!0),F=n(0),x=n(""),d=async()=>{var l,t,e,s;B.value=!0;try{const{data:u}=await w.get("/news/all",{params:{page:b.value,itemsPerPage:C.value,sortBy:((l=V.value[0])==null?void 0:l.key)||"createdAt",sortOrder:((t=V.value[0])==null?void 0:t.order)==="asc"?1:-1,search:x.value}});S.value.splice(0,S.value.length,...u.result.data),F.value=u.result.total}catch(u){console.log(u);const R=((s=(e=u==null?void 0:u.response)==null?void 0:e.data)==null?void 0:s.message)||"發生錯誤，請稍後再試";U.fire({position:"center",icon:"error",title:R,showConfirmButton:!0})}B.value=!1};d();const h=()=>{b.value=1,d()};return(l,t)=>(M(),E(J,null,[a(ae,null,{default:o(()=>[a(ue,null,{default:o(()=>[a(_,{cols:"12"},{default:o(()=>[fe]),_:1}),a(ie),a(_,{cols:"12"},{default:o(()=>[a(k,{color:"green",onClick:t[0]||(t[0]=e=>A())},{default:o(()=>[m("新增消息")]),_:1})]),_:1}),a(_,{cols:"12"},{default:o(()=>[a(oe,{"items-per-page":C.value,"onUpdate:itemsPerPage":[t[2]||(t[2]=e=>C.value=e),d],"sort-by":V.value,"onUpdate:sortBy":[t[3]||(t[3]=e=>V.value=e),d],page:b.value,"onUpdate:page":[t[4]||(t[4]=e=>b.value=e),d],items:S.value,headers:O,loading:B.value,"items-length":F.value,search:x.value,hover:""},{top:o(()=>[a(I,{label:"搜尋","append-icon":"mdi-magnify",modelValue:x.value,"onUpdate:modelValue":t[1]||(t[1]=e=>x.value=e),"onClick:append":h,onKeydown:Z(h,["enter"])},null,8,["modelValue"])]),"item.group":o(({item:e})=>[m(N(e.group),1)]),"item.poText":o(({item:e})=>[e.poText?(M(),j(ve,{key:0,icon:"mdi-check"})):z("",!0)]),"item.edit":o(({item:e})=>[a(k,{icon:"mdi-pencil",variant:"text",color:"blue",onClick:s=>A(e)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),a(le,{modelValue:p.value,"onUpdate:modelValue":t[9]||(t[9]=e=>p.value=e),persistent:"",width:"500px"},{default:o(()=>[a(te,{disabled:r(T),onSubmit:G(r(H),["prevent"])},{default:o(()=>[a(de,null,{default:o(()=>[a(me,null,{default:o(()=>[m(N(i.value===""?"新增消息":"編輯消息"),1)]),_:1}),a(pe,null,{default:o(()=>[a(I,{label:"標題",modelValue:r(c).value.value,"onUpdate:modelValue":t[5]||(t[5]=e=>r(c).value.value=e),"error-messages":r(c).errorMessage.value},null,8,["modelValue","error-messages"]),a(ge,{label:"類別",items:$,modelValue:r(v).value.value,"onUpdate:modelValue":t[6]||(t[6]=e=>r(v).value.value=e),"error-messages":r(v).errorMessage.value},null,8,["modelValue","error-messages"]),a(re,{label:"上架",modelValue:r(f).value.value,"onUpdate:modelValue":t[7]||(t[7]=e=>r(f).value.value=e),"error-messages":r(f).errorMessage.value},null,8,["modelValue","error-messages"]),a(se,{label:"內容",modelValue:r(g).value.value,"onUpdate:modelValue":t[8]||(t[8]=e=>r(g).value.value=e),"error-messages":r(g).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),a(ce,null,{default:o(()=>[a(ne),a(k,{color:"red",disabled:r(T),onClick:D},{default:o(()=>[m("取消")]),_:1},8,["disabled"]),a(k,{color:"green",type:"submit",loading:r(T)},{default:o(()=>[m("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64))}};export{qe as default};
