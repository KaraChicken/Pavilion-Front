import{$ as w,D as B,E as F,r as $,o as C,G as V,H as M,J as P,c as a,L as s,N as T,S as E,Q as l,R as m,P as i,Z as H}from"./index-8f327957.js";import{c as N,e as R,u as k,b as A,V as D}from"./VForm-8ae878e1.js";import{S as d}from"./sweetalert2.all-04b561c2.js";import{V as L}from"./VContainer-1ee2bd48.js";import{V as U}from"./VOverlay-d5accc61.js";import{V as p}from"./VCol-c80f8076.js";import{V as j}from"./index-6c4cdc40.js";import{V as G}from"./VTextField-e65f6a72.js";import{V as y}from"./VBtn-837c59bf.js";/* empty css              */import"./tag-0f71946a.js";import"./scopeId-afa33d66.js";import"./index-bb123c91.js";const re={__name:"ProductView",setup(I){const h=w(),f=B(),{api:x,apiAuth:b}=E(),_=F(),t=$({_id:"",name:"",price:0,description:"",image:"",sell:!0,category:""}),v=N({quantity:R().typeError("缺少數量").required("缺少數量").min(1,"數量最小為 1")}),{isSubmitting:g,handleSubmit:S}=k({validationSchema:v,initialValues:{quantity:1}}),n=A("quantity",v),q=S(async u=>{var o,e;if(!_.isLogin){f.push("/login");return}try{const{data:r}=await b.patch("/users/cart",{product:t.value._id,quantity:u.quantity});_.cart=r.result,d.fire({icon:"success",title:"新增成功",timer:800})}catch(r){const c=((e=(o=r==null?void 0:r.response)==null?void 0:o.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";d.fire({icon:"error",title:c,confirmButtonText:"確定"})}});return C(async()=>{var u,o;try{const{data:e}=await x.get("/products/"+h.params.id);t.value._id=e.result._id,t.value.name=e.result.name,t.value.price=e.result.price,t.value.description=e.result.description,t.value.image=e.result.image,t.value.sell=e.result.sell,t.value.category=e.result.category,document.title=`購物網 | ${t.value.name}`}catch(e){const r=((o=(u=e==null?void 0:e.response)==null?void 0:u.data)==null?void 0:o.message)||"發生錯誤，請稍後再試";d.fire({icon:"error",title:r,confirmButtonText:"確定"}),f.push("/")}}),(u,o)=>{const e=V("H1"),r=V("P");return M(),P(T,null,[a(L,null,{default:s(()=>[a(p,{cols:"12"},{default:s(()=>[a(e,null,{default:s(()=>[l(m(t.value.name),1)]),_:1})]),_:1}),a(p,{cols:"12",md:"6"},{default:s(()=>[a(j,{src:t.value.image},null,8,["src"])]),_:1}),a(p,{cols:"12",md:"6"},{default:s(()=>[a(r,null,{default:s(()=>[l("$"+m(t.value.price),1)]),_:1}),a(r,{style:{"width-space":"pre"}},{default:s(()=>[l(m(t.value.description),1)]),_:1}),a(D,{disabled:i(g),onSubmit:H(i(q),["prevent"])},{default:s(()=>[a(G,{type:"number",min:"0",modelValue:i(n).value.value,"onUpdate:modelValue":o[0]||(o[0]=c=>i(n).value.value=c),modelModifiers:{number:!0},"error-messages":i(n).errorMessage.value},null,8,["modelValue","error-messages"]),a(y,{type:"submit","prepend-icon":"mdi-cart",loading:i(g)},{default:s(()=>[l("加入購物車")]),_:1},8,["loading"])]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1}),a(U,{class:"align-center justify-center text-center","model-value":!t.value.sell},{default:s(()=>[a(e,{class:"text-red text-h1"},{default:s(()=>[l("已下架")]),_:1}),a(y,{to:"/",color:"green"},{default:s(()=>[l("回首頁")]),_:1})]),_:1},8,["model-value"])],64)}}};export{re as default};
