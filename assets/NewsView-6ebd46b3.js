import{_ as J,r as n,H as M,J as Q,c as a,L as o,N as Z,T as j,R as p,ag as z,S as D,K as G,M as W,Q as s,a4 as X,a0 as Y,a1 as ee,Z as te}from"./index-c410946d.js";import{c as ae,a as I,f as le,u as oe,b as w,V as se}from"./VForm-1ccd308f.js";import{S as U}from"./sweetalert2.all-04b561c2.js";import{V as re}from"./VContainer-37ad4d41.js";import{V as ne,a as ue,b as ie,c as de,d as pe}from"./VTextarea-c525370f.js";import{a as me,V as N}from"./VRow-6636cebc.js";import{V as _}from"./VBtn-e25d9e9d.js";import{V as $}from"./VTextField-717bb8b4.js";import{d as ce,V as ge,b as ve,c as Ve}from"./VCard-30470140.js";import{V as fe}from"./VSelect-18d3310e.js";import{i as be}from"./index-a222e3fa.js";/* empty css              */import"./tag-efd47ea5.js";import"./VAvatar-61ea13d3.js";import"./VDataTable-a5904860.js";import"./VList-04835825.js";import"./index-cc88d0aa.js";import"./VOverlay-c5a646a9.js";import"./scopeId-88254911.js";const xe=m=>(Y("data-v-0bc0da45"),m=m(),ee(),m),ye=xe(()=>te("h1",{class:"text-center"},"消息發布",-1)),we={__name:"NewsView",setup(m){const{apiAuth:T}=j();n(null);const c=n(!1),i=n(""),P=l=>{l?(i.value=l._id,g.value.value=l.title,V.value.value=l.group,v.value.value=l.content,f.value.value=l.poText):i.value="",c.value=!0},A=()=>{c.value=!1,H()},q=["公休","活動","其他"],L=ae({title:I().required("請輸入標題").min(2,"標題太短").max(50,"標題太長"),group:I().required("請選擇類別").oneOf(["公休","活動","其他"],"類別選擇錯誤"),content:I().required("請輸入內容").min(10,"內容太短").max(100,"內容太長"),poText:le().required("請選擇貼文上架狀態")}),{handleSubmit:K,isSubmitting:k,resetForm:H}=oe({validationSchema:L,initialValues:{group:"",title:"",content:"",poText:!1,_id:""}}),g=w("title"),v=w("content"),V=w("group"),f=w("poText"),O=K(async l=>{var t,e;try{i.value===""?await T.post("/news",{group:l.group,title:l.title,content:l.content,poText:l.poText}):await T.patch("/news/"+i.value,{group:l.group,title:l.title,content:l.content,poText:l.poText});const r=i.value===""?"新增成功":"編輯成功";U.fire({position:"center",icon:"success",title:r,showConfirmButton:!1,timer:1500}),A(),B()}catch(r){console.log(r);const u=((e=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";U.fire({position:"center",icon:"error",title:u,showConfirmButton:!1})}}),S=n(10),b=n([{key:"createdAt",order:"desc"}]),x=n(1),C=n([]),R=[{title:"類別",align:"center",sortable:!0,key:"group"},{title:"標題",align:"center",sortable:!1,key:"title"},{title:"內容",align:"center",sortable:!0,key:"content"},{title:"上架狀態",align:"center",sortable:!0,key:"poText"},{title:"編輯",align:"center",sortable:!1,key:"edit"}],h=n(!0),F=n(0),y=n(""),d=async()=>{var l,t,e,r;h.value=!0;try{const{data:u}=await T.get("/news/all",{params:{page:x.value,itemsPerPage:S.value,sortBy:((l=b.value[0])==null?void 0:l.key)||"createdAt",sortOrder:((t=b.value[0])==null?void 0:t.order)==="asc"?1:-1,search:y.value}});C.value.splice(0,C.value.length,...u.result),F.value=u.total}catch(u){console.log(u);const E=((r=(e=u==null?void 0:u.response)==null?void 0:e.data)==null?void 0:r.message)||"發生錯誤，請稍後再試";U.fire({position:"center",icon:"error",title:E,showConfirmButton:!0})}h.value=!1};d();const B=()=>{x.value=1,d()};return(l,t)=>(M(),Q(Z,null,[a(re,null,{default:o(()=>[a(me,null,{default:o(()=>[a(N,{cols:"12"},{default:o(()=>[ye]),_:1}),a(N,{cols:"12"},{default:o(()=>[a(_,{color:"green",onClick:t[0]||(t[0]=e=>P())},{default:o(()=>[p("新增消息")]),_:1})]),_:1}),a(N,{cols:"12"},{default:o(()=>[a(ue,{"items-per-page":S.value,"onUpdate:itemsPerPage":[t[2]||(t[2]=e=>S.value=e),d],"sort-by":b.value,"onUpdate:sortBy":[t[3]||(t[3]=e=>b.value=e),d],page:x.value,"onUpdate:page":[t[4]||(t[4]=e=>x.value=e),d],items:C.value,headers:R,loading:h.value,"items-length":F.value,search:y.value,hover:""},{top:o(()=>[a($,{label:"搜尋","append-icon":"mdi-magnify",modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=e=>y.value=e),"onClick:append":B,onKeydown:z(B,["enter"])},null,8,["modelValue"])]),"item.group":o(({item:e})=>[p(D(e.group),1)]),"item.poText":o(({item:e})=>[e.poText?(M(),G(be,{key:0,icon:"mdi-check"})):W("",!0)]),"item.edit":o(({item:e})=>[a(_,{icon:"mdi-pencil",variant:"text",color:"#A0674B",onClick:r=>P(e)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),a(ne,{modelValue:c.value,"onUpdate:modelValue":t[9]||(t[9]=e=>c.value=e),persistent:"",width:"500px"},{default:o(()=>[a(se,{disabled:s(k),onSubmit:X(s(O),["prevent"])},{default:o(()=>[a(ce,null,{default:o(()=>[a(ge,null,{default:o(()=>[p(D(i.value===""?"新增消息":"編輯消息"),1)]),_:1}),a(ve,null,{default:o(()=>[a($,{label:"標題",modelValue:s(g).value.value,"onUpdate:modelValue":t[5]||(t[5]=e=>s(g).value.value=e),"error-messages":s(g).errorMessage.value},null,8,["modelValue","error-messages"]),a(fe,{label:"類別",items:q,modelValue:s(V).value.value,"onUpdate:modelValue":t[6]||(t[6]=e=>s(V).value.value=e),"error-messages":s(V).errorMessage.value},null,8,["modelValue","error-messages"]),a(ie,{label:"上架",modelValue:s(f).value.value,"onUpdate:modelValue":t[7]||(t[7]=e=>s(f).value.value=e),"error-messages":s(f).errorMessage.value},null,8,["modelValue","error-messages"]),a(de,{label:"內容",modelValue:s(v).value.value,"onUpdate:modelValue":t[8]||(t[8]=e=>s(v).value.value=e),"error-messages":s(v).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),a(Ve,null,{default:o(()=>[a(pe),a(_,{color:"red",disabled:s(k),onClick:A},{default:o(()=>[p("取消")]),_:1},8,["disabled"]),a(_,{color:"green",type:"submit",loading:s(k)},{default:o(()=>[p("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64))}},He=J(we,[["__scopeId","data-v-0bc0da45"]]);export{He as default};
